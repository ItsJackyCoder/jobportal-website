<!DOCTYPE html>
<html lang="en"
      xmlns:th="https://www.thymeleaf.org/"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" style="height: 100%">
  <head>
    <meta charset="UTF-8"/>
    <title>Candidate Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css} "/>
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.css}"/>
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  </head>

  <body th:object="${jobDetails}" style="font-family: 'Montserrat';height: 100%">

    <header class="navbar navbar-expand-lg navbar-dark">
      <label class="mt-2 ms-4 fw-bold h5">
        <img th:src="@{/assets/job-icon.png}"
             alt="main-logo"
             class="main-logo">
        <a th:href="@{/dashboard/}">JackyCoder</a>
        <span class="logo_com fw-bold h5 text-white">World</span>
      </label>

      <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarToggler"
              aria-controls="navbarToggler"
              aria-expanded="false"
              aria-label="Toggle navigation">

        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarToggler">
        <ul class="navbar-nav m-auto mt-2 mt-lg-0">

          <!-- Job Seeker section-->
          <li class="nav-item active">
            <a sec:authorize="hasAuthority('Job Seeker') or isAnonymous()" class="nav-link" th:href="@{/dashboard/}">
              <i class="fas fa-search"></i>Search for Jobs</a>
          </li>
          <li class="nav-item ">
            <a sec:authorize="hasAuthority('Job Seeker') or isAnonymous()" class="nav-link" th:href="@{/saved-jobs/}">
              <i class="fa-solid fa-eye"></i>View Saved Jobs</a>
          </li>
          <li class="nav-item ">
            <a sec:authorize="hasAuthority('Job Seeker') or isAnonymous()" class="nav-link"
               th:href="@{/job-seeker-profile/}">
              <i class="fa-solid fa-pencil"></i>Edit Profile</a>
          </li>

          <!-- Recruiter section-->
          <li class="nav-item ">
            <a sec:authorize="hasAuthority('Recruiter')" class="nav-link" th:href="@{/dashboard/add}">
              <i class="fa-solid fa-file-circle-plus"></i>Post New Job</a>
          </li>
          <li class="nav-item active">
            <a sec:authorize="hasAuthority('Recruiter')" class="nav-link" th:href="@{/dashboard/}">
              <i class="fa-solid fa-eye"></i>View Your Jobs</a>
          </li>
          <li class="nav-item ">
            <a sec:authorize="hasAuthority('Recruiter')" class="nav-link" th:href="@{/recruiter-profile/}">
              <i class="fa-solid fa-pencil"></i>Edit Account</a>
          </li>

        </ul>
        <img
                sec:authorize="hasAnyAuthority('Recruiter','Job Seeker')"
                class="rounded-circle me-3"
                height="50px"
                width="50px"
                th:if="${user.photosImagePath!=null}"
                th:src="@{${user.photosImagePath}}"/>

        <label sec:authorize="hasAnyAuthority('Recruiter','Job Seeker')"
               th:if="${user.firstName != null && user.lastName != null}"
               th:text="${user.firstName + ' ' + user.lastName}"
               class="nav-item nav-link px-2 me-3">John Doe</label>

        <label sec:authorize="hasAnyAuthority('Recruiter','Job Seeker')"
               th:unless="${user.firstName != null && user.lastName != null}" th:text="${user.userId.email}"
               class="nav-item nav-link px-2 me-3">
        </label>

        <button sec:authorize="hasAnyAuthority('Recruiter','Job Seeker')"
                class="myBtn-light me-5"
                onclick="window.location.href='/logout'">Logout
        </button>

        <!-- 匿名訪問時 -->
        <label sec:authorize="isAnonymous()"
               class="nav-item nav-link px-2 me-3">Guest</label>

        <button sec:authorize="isAnonymous()"
                class="myBtn-light me-5"
                onclick="window.location.href='/logout'">Home Page
        </button>
      </div>
    </header>


    <!-- header-end -->
    <section class="section">
      <!--    Side Bar Starts here    -->
      <div class="sidenav px-5">
        <div>
          <hr/>
        </div>
      </div>
      <article>
        <!-- Job Detail的上半部 -->
        <div class="box px-3">
          <a class="mt-3 ms-3 primary" id="back-link"><i class="fa-solid fa-angle-left me-1"></i>Back to</a>
          <h1 class="primary-title mt-3"> Job Details </h1>
          <div class="ms-3">
            <h4 th:text="${jobDetails.jobTitle}" class="job-title-apply-list text-start">Software Engineer</h4>
            <div class="mt-1">
              <p th:text="${jobDetails.jobLocationId.city+', '+ jobDetails.jobLocationId.state}"
                 class="m-0"> California, USA</p>
              <p th:text="${jobDetails.jobCompanyId.name}">Company</p>
            </div>
          </div>
        </div>

        <!-- Job Detail的下半部 -->
        <div class="box mt-3">
          <label class="large-label px-3 mt-3"> Job Specs </label>

          <div class="job-row">
            <div class="row">
              <div class="col-md-3" style="text-align: center;">
                <label>Date Posted:<br><span
                        th:text="${#dates.format(jobDetails.postedDate, 'yyyy-MM-dd HH:mm')}">12 Nov, 2030</span></label>
              </div>
              <div class="col-md-3" style="text-align: center;">
                <label> Salary:<br><span th:text="${jobDetails.salary}">50k - 120k/y</span></label>
              </div>
              <div class="col-md-3" style="text-align: center;">
                <label>Type:<br><span th:text="${jobDetails.jobType}"> Full-time</span></label>
              </div>
              <div class="col-md-3" style="text-align: center;">
                <label>Remote:<br><span th:text="${jobDetails.remote}">Remote</span></label>
              </div>
            </div>
          </div>

          <div class="px-3 mb-4">
            <label class="large-label">Job Description</label>
            <div class="mt-2" th:utext="${jobDetails.descriptionOfJob}"></div>
          </div>

          <div class="mt-3 px-3" sec:authorize="hasAuthority('Job Seeker')">
            <div class="row">
              <div class="col-md-3">
                <form th:action="@{/job-details/apply/{id}(id=${jobDetails.jobPostId})}" th:object="${applyJob}"
                      method="post">
                  <button class="btn-sec btn-red w-100" type="submit" th:if="${alreadyApplied == false}">
                    Apply Now
                  </button>
                </form>

                <form th:action="@{/job-details/withdraw/{id}(id=${jobDetails.jobPostId})}" th:object="${applyJob}"
                      method="post">
                  <button class="btn-sec btn-red w-100" type="submit" th:if="${alreadyApplied == true}">
                    Withdraw Application
                  </button>
                </form>

              </div>
              <div class="col-md-3">
                <form th:action="@{/job-details/save/{id}(id=${jobDetails.jobPostId})}" th:object="${applyJob}"
                      method="post">
                  <button class="btn-sec btn-black w-100" type="submit" th:if="${alreadySaved == false}">Save
                    Job
                  </button>
                </form>

                <form th:action="@{/job-details/unsave/{id}(id=${jobDetails.jobPostId})}" th:object="${applyJob}"
                      method="post">
                  <button class="btn-sec btn-black w-100" type="submit" th:if="${alreadySaved == true}">Unsave</button>
                </form>
              </div>
            </div>
          </div>

          <div class="mt-3 px-3" sec:authorize="hasAuthority('Recruiter')">
            <div class="row">
              <div class="col-md-3">
                <form th:action="@{/dashboard/edit/{id}(id=${jobDetails.jobPostId})}" method="post">
                  <button class="btn-sec btn-red w-100" type="submit">Edit Job</button>
                </form>
              </div>

              <div class="col-md-3">
                <form th:action="@{/dashboard/deleteJob/{id}(id=${jobDetails.jobPostId})}" method="post">
                  <button class="btn-sec btn-black w-100" type="submit">Delete Job</button>
                </form>
              </div>
              <div class="col-md-3">
                <form th:action="@{/dashboard/jobApplicantsList/{id}(id=${jobDetails.jobPostId})}">
                  <button class="btn-sec btn-grey w-100" type="submit"
                          th:text="${'Applied: ' + applyList.size()}"></button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </article>
    </section>

    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>

    <script>
        const element = document.getElementById('back-link');
        element.setAttribute('href', document.referrer);
        element.onclick = function () {
            history.back();
            return false;
        }
    </script>
  </body>
</html>